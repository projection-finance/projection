{"ast":null,"code":"var _jsxFileName = \"/Users/max/Documents/GitHub/Projection/src/components/Modals/action.js\",\n    _s = $RefreshSig$();\n\nimport * as React from \"react\";\nimport Box from \"@mui/material/Box\";\nimport Button from \"@mui/material/Button\";\nimport Typography from \"@mui/material/Typography\";\nimport Modal from \"@mui/material/Modal\";\nimport styles from \"./addProject.module.css\";\nimport TextField from \"@mui/material/TextField\";\nimport { useDispatch } from \"react-redux\";\nimport InputLabel from \"@material-ui/core/InputLabel\";\nimport Stack from \"@mui/material/Stack\";\nimport DateAdapter from \"@mui/lab/AdapterMoment\";\nimport LocalizationProvider from \"@mui/lab/LocalizationProvider\";\nimport moment from \"moment\";\nimport DesktopDatePicker from \"@mui/lab/DesktopDatePicker\";\nimport { ADD_ACTION_TO_Projection } from \"../../redux/projections/projection.types\";\nimport Input from \"@mui/material/Input\";\nimport MenuItem from \"@mui/material/MenuItem\";\nimport FormControl from \"@mui/material/FormControl\";\nimport Select from \"@mui/material/Select\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst style = {\n  position: \"absolute\",\n  top: \"50%\",\n  left: \"50%\",\n  transform: \"translate(-50%, -50%)\",\n  width: \"80%\",\n  height: \"80%\",\n  overflowY: \"scroll\",\n  bgcolor: \"background.paper\",\n  p: 4\n};\nexport default function Action1(_ref) {\n  _s();\n\n  let {\n    open,\n    handleClose,\n    projection,\n    action\n  } = _ref;\n  const rx_live = /^\\d+(?:[.,]{1}\\d*)?$/;\n  const dispatch = useDispatch();\n  const [date, setDate] = React.useState(moment(projection.startDate));\n  const [minDate, setMinDate] = React.useState(moment(projection.startDate));\n  const [assetIndex, setAssetIndex] = React.useState(-1);\n  const [selectedAsset, setSelectedAsset] = React.useState(null);\n  const [newPrice, setNewPrice] = React.useState(null);\n  const [erreur, setErreur] = React.useState(\"\");\n  const [showErr, setShowErr] = React.useState(false);\n\n  const isDateValid = function () {\n    let d = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    d = d ? d.toDate().getTime() : date.toDate().getTime();\n    return d >= minDate.toDate().getTime() && d <= moment(projection.endDate).toDate().getTime();\n  };\n\n  const handleDateChange = newValue => {\n    if (isDateValid(newValue)) {\n      setDate(newValue);\n      setShowErr(false);\n    } else {\n      setErreur(`Date must be in ${minDate.format(\"DD-MM-YYYY\")} & ${moment(projection.endDate).format(\"DD-MM-YYYY\")}`);\n      setShowErr(true);\n    }\n  };\n\n  const findLastActionByCoin = coin => {\n    console.log(projection);\n    const arr = projection.actions.filter(act => {\n      return act.coin.name === coin.name;\n    });\n    console.log(arr);\n    return arr.length > 0 ? moment(arr[arr.length - 1].date).add(1, \"days\") : moment(projection.startDate).subtract(1, \"days\");\n  };\n\n  const handleChange = event => {\n    const index = event.target.value;\n    setAssetIndex(index);\n    setSelectedAsset(projection.coins[index]);\n    setNewPrice(projection.coins[index].currentPrice);\n    setMinDate(findLastActionByCoin(projection.coins[index]));\n    setDate(findLastActionByCoin(projection.coins[index]));\n  };\n\n  const handleNepChange = event => {\n    let val = event.target.value;\n    val = val.replace(\",\", \".\");\n    if (rx_live.test(val)) setNewPrice(val);\n  };\n\n  const handleAddAction = () => {\n    if (rx_live.test(newPrice) && isDateValid()) {\n      const newaction = {\n        id: (Math.random() + 1).toString(36).substring(7),\n        coin: selectedAsset,\n        date,\n        type: action.name,\n        price: newPrice\n      };\n      dispatch({\n        type: ADD_ACTION_TO_Projection,\n        payload: {\n          projection,\n          action: newaction\n        }\n      });\n      handleClose();\n      setShowErr(false);\n    } else {\n      setErreur(`Please check your information :\n        -Date must be in ${minDate.format(\"DD-MM-YYYY\")} & ${moment(projection.endDate).format(\"DD-MM-YYYY\")}!\n        -Price must be a number!\n      `);\n      setShowErr(true);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(Modal, {\n      open: open,\n      onClose: handleClose,\n      \"aria-labelledby\": \"modal-modal-title\",\n      \"aria-describedby\": \"modal-modal-description\",\n      sx: {\n        borderRadius: 4\n      },\n      children: /*#__PURE__*/_jsxDEV(Box, {\n        sx: style,\n        className: styles[\"modal\"],\n        children: [showErr ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: styles[\"error\"],\n          children: erreur\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 22\n        }, this) : \"\", /*#__PURE__*/_jsxDEV(Typography, {\n          id: \"modal-modal-description\",\n          sx: {\n            mt: 2\n          },\n          children: [\"Configure your Action:\", action.name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(LocalizationProvider, {\n          dateAdapter: DateAdapter,\n          children: /*#__PURE__*/_jsxDEV(Stack, {\n            spacing: 3,\n            children: [\" \", /*#__PURE__*/_jsxDEV(DesktopDatePicker, {\n              label: \"Start Date\",\n              inputFormat: \"DD-MM-YYYY\",\n              value: date,\n              disabled: selectedAsset === null,\n              onChange: handleDateChange,\n              renderInput: params => /*#__PURE__*/_jsxDEV(TextField, { ...params\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 139,\n                columnNumber: 42\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 133,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Stack, {\n          children: [/*#__PURE__*/_jsxDEV(FormControl, {\n            fullWidth: true,\n            children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n              id: \"demo-simple-select-label\",\n              children: \"Assets\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 145,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Select, {\n              labelId: \"demo-simple-select-label\",\n              id: \"demo-simple-select\",\n              label: \"Assets\",\n              value: assetIndex,\n              onChange: handleChange,\n              children: projection.coins.map((coin, index) => {\n                return /*#__PURE__*/_jsxDEV(MenuItem, {\n                  value: index,\n                  children: coin.name\n                }, index, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 155,\n                  columnNumber: 21\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 146,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 13\n          }, this), selectedAsset ? /*#__PURE__*/_jsxDEV(FormControl, {\n            fullWidth: true,\n            children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n              htmlFor: \"component-helper\",\n              children: [\"Current price \", selectedAsset.currentPrice, \"$\", \" \"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 164,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Input, {\n              type: \"text\",\n              placeholder: \"Current price\",\n              value: newPrice,\n              onChange: handleNepChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 168,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 15\n          }, this) : \"\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles[\"modal-footer\"],\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            variant: \"contained\",\n            onClick: handleAddAction,\n            children: \"Save Changes\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"outlined\",\n            onClick: handleClose,\n            children: \"Close\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 116,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Action1, \"J4+OKtto/sZMbBhVXXZT+IfPEHM=\", false, function () {\n  return [useDispatch];\n});\n\n_c = Action1;\n\nvar _c;\n\n$RefreshReg$(_c, \"Action1\");","map":{"version":3,"sources":["/Users/max/Documents/GitHub/Projection/src/components/Modals/action.js"],"names":["React","Box","Button","Typography","Modal","styles","TextField","useDispatch","InputLabel","Stack","DateAdapter","LocalizationProvider","moment","DesktopDatePicker","ADD_ACTION_TO_Projection","Input","MenuItem","FormControl","Select","style","position","top","left","transform","width","height","overflowY","bgcolor","p","Action1","open","handleClose","projection","action","rx_live","dispatch","date","setDate","useState","startDate","minDate","setMinDate","assetIndex","setAssetIndex","selectedAsset","setSelectedAsset","newPrice","setNewPrice","erreur","setErreur","showErr","setShowErr","isDateValid","d","toDate","getTime","endDate","handleDateChange","newValue","format","findLastActionByCoin","coin","console","log","arr","actions","filter","act","name","length","add","subtract","handleChange","event","index","target","value","coins","currentPrice","handleNepChange","val","replace","test","handleAddAction","newaction","id","Math","random","toString","substring","type","price","payload","borderRadius","mt","params","map"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport Box from \"@mui/material/Box\";\nimport Button from \"@mui/material/Button\";\nimport Typography from \"@mui/material/Typography\";\nimport Modal from \"@mui/material/Modal\";\nimport styles from \"./addProject.module.css\";\nimport TextField from \"@mui/material/TextField\";\nimport { useDispatch } from \"react-redux\";\nimport InputLabel from \"@material-ui/core/InputLabel\";\nimport Stack from \"@mui/material/Stack\";\nimport DateAdapter from \"@mui/lab/AdapterMoment\";\nimport LocalizationProvider from \"@mui/lab/LocalizationProvider\";\nimport moment from \"moment\";\nimport DesktopDatePicker from \"@mui/lab/DesktopDatePicker\";\nimport { ADD_ACTION_TO_Projection } from \"../../redux/projections/projection.types\";\nimport Input from \"@mui/material/Input\";\nimport MenuItem from \"@mui/material/MenuItem\";\nimport FormControl from \"@mui/material/FormControl\";\nimport Select from \"@mui/material/Select\";\nconst style = {\n  position: \"absolute\",\n  top: \"50%\",\n  left: \"50%\",\n  transform: \"translate(-50%, -50%)\",\n  width: \"80%\",\n  height: \"80%\",\n  overflowY: \"scroll\",\n  bgcolor: \"background.paper\",\n  p: 4,\n};\n\nexport default function Action1({ open, handleClose, projection, action }) {\n  const rx_live = /^\\d+(?:[.,]{1}\\d*)?$/;\n  const dispatch = useDispatch();\n  const [date, setDate] = React.useState(moment(projection.startDate));\n  const [minDate, setMinDate] = React.useState(moment(projection.startDate));\n  const [assetIndex, setAssetIndex] = React.useState(-1);\n  const [selectedAsset, setSelectedAsset] = React.useState(null);\n  const [newPrice, setNewPrice] = React.useState(null);\n  const [erreur, setErreur] = React.useState(\"\");\n  const [showErr, setShowErr] = React.useState(false);\n\n  const isDateValid = (d = null) => {\n    d = d ? d.toDate().getTime() : date.toDate().getTime();\n    return (\n      d >= minDate.toDate().getTime() &&\n      d <= moment(projection.endDate).toDate().getTime()\n    );\n  };\n\n  const handleDateChange = (newValue) => {\n    if (isDateValid(newValue)) {\n      setDate(newValue);\n      setShowErr(false);\n    } else {\n      setErreur(\n        `Date must be in ${minDate.format(\"DD-MM-YYYY\")} & ${moment(\n          projection.endDate\n        ).format(\"DD-MM-YYYY\")}`\n      );\n      setShowErr(true);\n    }\n  };\n\n  const findLastActionByCoin = (coin) => {\n    console.log(projection);\n    const arr = projection.actions.filter((act) => {\n      return act.coin.name === coin.name;\n    });\n    console.log(arr);\n    return arr.length > 0\n      ? moment(arr[arr.length - 1].date).add(1, \"days\")\n      : moment(projection.startDate).subtract(1, \"days\");\n  };\n  const handleChange = (event) => {\n    const index = event.target.value;\n    setAssetIndex(index);\n    setSelectedAsset(projection.coins[index]);\n    setNewPrice(projection.coins[index].currentPrice);\n    setMinDate(findLastActionByCoin(projection.coins[index]));\n    setDate(findLastActionByCoin(projection.coins[index]));\n  };\n  const handleNepChange = (event) => {\n    let val = event.target.value;\n    val = val.replace(\",\", \".\");\n    if (rx_live.test(val)) setNewPrice(val);\n  };\n\n  const handleAddAction = () => {\n    if (rx_live.test(newPrice) && isDateValid()) {\n      const newaction = {\n        id: (Math.random() + 1).toString(36).substring(7),\n        coin: selectedAsset,\n        date,\n        type: action.name,\n        price: newPrice,\n      };\n      dispatch({\n        type: ADD_ACTION_TO_Projection,\n        payload: { projection, action: newaction },\n      });\n      handleClose();\n      setShowErr(false);\n    } else {\n      setErreur(`Please check your information :\n        -Date must be in ${minDate.format(\"DD-MM-YYYY\")} & ${moment(\n        projection.endDate\n      ).format(\"DD-MM-YYYY\")}!\n        -Price must be a number!\n      `);\n      setShowErr(true);\n    }\n  };\n\n  return (\n    <div>\n      <Modal\n        open={open}\n        onClose={handleClose}\n        aria-labelledby=\"modal-modal-title\"\n        aria-describedby=\"modal-modal-description\"\n        sx={{borderRadius:4}}\n      >\n        <Box sx={style} className={styles[\"modal\"]}>\n          {showErr ? <p className={styles[\"error\"]}>{erreur}</p> : \"\"}\n          <Typography id=\"modal-modal-description\" sx={{ mt: 2 }}>\n            Configure your Action:{action.name}\n          </Typography>\n\n          <LocalizationProvider dateAdapter={DateAdapter}>\n            <Stack spacing={3}>\n              {\" \"}\n              <DesktopDatePicker\n                label=\"Start Date\"\n                inputFormat=\"DD-MM-YYYY\"\n                value={date}\n                disabled={selectedAsset === null}\n                onChange={handleDateChange}\n                renderInput={(params) => <TextField {...params} />}\n              />\n            </Stack>\n          </LocalizationProvider>\n          <Stack>\n            <FormControl fullWidth>\n              <InputLabel id=\"demo-simple-select-label\">Assets</InputLabel>\n              <Select\n                labelId=\"demo-simple-select-label\"\n                id=\"demo-simple-select\"\n                label=\"Assets\"\n                value={assetIndex}\n                onChange={handleChange}\n              >\n                {projection.coins.map((coin, index) => {\n                  return (\n                    <MenuItem key={index} value={index}>\n                      {coin.name}\n                    </MenuItem>\n                  );\n                })}\n              </Select>\n            </FormControl>\n            {selectedAsset ? (\n              <FormControl fullWidth>\n                <InputLabel htmlFor=\"component-helper\">\n                  Current price {selectedAsset.currentPrice}${\" \"}\n                </InputLabel>\n\n                <Input\n                  type=\"text\"\n                  placeholder=\"Current price\"\n                  value={newPrice}\n                  onChange={handleNepChange}\n                />\n              </FormControl>\n            ) : (\n              \"\"\n            )}\n          </Stack>\n\n          <div className={styles[\"modal-footer\"]}>\n            <Button variant=\"contained\" onClick={handleAddAction}>\n              Save Changes\n            </Button>\n            <Button variant=\"outlined\" onClick={handleClose}>\n              Close\n            </Button>\n          </div>\n        </Box>\n      </Modal>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}